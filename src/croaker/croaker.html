<!DOCTYPE html>
<html>
  <head>
    <title>Croaker</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>   
    <script type="text/javascript" src="js/lib/mustache.js"></script>   
    <script type="text/javascript" src="js/croaker.js"></script>

    <link rel="stylesheet" type="text/css" href="css/croaker.css" />
    <script id="metrics" type="text-x-mustache-tmpl">
          {{#metrics}}  
            <td>
              {{value}}
            </td>            
            
            {{/metrics}}
    </script>
    <script id="sampletable" type="text-x-mustache-tmpl">
      <table border="1" cellpadding="10">
        <thead>
          <tr>
            <td>
              Name
            </td>
            <td>
              Maintainability Index
            </td>
            <td>
              Cyclomatic Complexity
            </td>
            <td>
              Class Coupling
            </td>
            <td>
              Depth Of Inheritance
            </td>
            <td>
              Lines Of Code
            </td>
          </tr>
          <tr>
            <td>
              {{name}}---{{version}} 
            </td>
            
            {{> metrics}}

          </thead>
          <tbody>                  
          </tr>
            {{#namespaces}}
            <tr>
              <td>
                {{name}}
              </td>
              
              {{> metrics}}
            
            </tr>
          
            {{#types}}
              <tr>
                <td>
                  {{name}}
                </td>
                {{> metrics}}
               </tr>
               
              {{#members}}
                 <tr>
                   <td>
                     {{name}} 
                    
                   </td>
                   {{> metrics}}
                  </tr> 
              {{/members}}                  
            {{/types}}            
          {{/namespaces}}   
       
        </tbody>
      </table>
    </script>    

    <script type="text/javascript">
      function parseData(xml) {
        var nodes = new croaker.Parser().parse(xml),
          module = new croaker.Mapper().map(nodes),
          results = $('#results'),
          template = $('#sampletable').html();
     
        results.html(Mustache.to_html(template, module, {metrics: $('#metrics').html()}));
      }
      
      function load(e) {
        e.stopPropagation();
        e.preventDefault();
        //var url = new croaker.LocationUrlParser().parse();
        var url = $('#file').val();
        console.log('url: ', url);
        var loader = new croaker.DataLoader(url, parseData);
        loader
          .execute()
          .fail(function (jqxhr, status, error) {
            console.log('error');
            console.log(status);
            console.log(error);
          });      
      }

      function init() {
        $('#btnload').click(load);
      }

      $(window).load(init);
    </script>
  </head>
  <body>
    <div id="main">
      <div id="flash" class="ui-widget-content ui-state-highlight ui-corner-all" style="display:none"></div>
      <div id="nav" class="ui-widget-content ui-corner-all">
        <form>
          <label for="file">File</label>
          <input id="file" type="text" value="sample.xml"/>
          <button id="btnload" class="ui-state-default ui-corner-all">Load</button>
        </form>      
        <form>
          <label for="filter">Filter</label>
          <input id="filter" type="text" />
          <button id="btnsearch" class="ui-state-default ui-corner-all">Search</button>
        </form>
        </br>
        </br>
      </div>
      <div id="results" class="ui-widget-content ui-corner-all"></div>
    </div>
  </body>
</html>