<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
  <script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
  <script type="text/javascript" src="../croaker/js/xml-to-json/jquery.xml2json.pack.js"></script>
  <script type="text/javascript" src="../croaker/js/underscore/underscore-min.js"></script>
  <script type="text/javascript" src="../croaker/js/croaker/croaker.js"></script>

  <link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />

  <script type="text/javascript">
    $(document).ready(function () {
      var loadedFiles = {};
      var parsed = {};

      var loader = function (key, path) {
        return $.get(path, function (xml) {
          loadedFiles[key] = xml;
        });
      };

      var parse = function () {
        parsed.basic = Croaker.parser.parse(loadedFiles['basic']);
        parsed.missing = Croaker.parser.parse(loadedFiles['missing']);
        start();
      }

      stop();
      $.when(loader('basic', 'data/basic.xml'), loader('missing', 'data/missing_members.xml'))
       .done(parse);

      module('module class tests');
      test('test defaults', function () {
        var mod = Croaker.module('mname', 'version');
        equals(mod.name, 'mname');
        equals(mod.version, 'version');
        equals(mod.tag, 'MOD');
        equals(mod.namespaces.length, 0);
        equals(mod.metrics.length, 0);
        equals(mod.parent, null);
        same(mod.location, ['mname']);
        equals(mod.fullName, 'mname');
      });

      test('test add namespaces', function () {
        var mod = Croaker.module('aname', 'version');
        var ns = Croaker.namespace('ns1');
        mod.add([ns]);
        deepEqual(mod.namespaces, [ns]);
        mod.add([ns, ns]);
        deepEqual(mod.namespaces, [ns, ns, ns]);
        equals(mod.metrics.length, 0);
      });

      module('namespace class tests');
      test('test defaults', function () {
        var mod = Croaker.module('mod.dll', 'version');
        var ns = Croaker.namespace(mod, 'nsname');
        equals(ns.name, 'nsname');
        equals(ns.tag, 'NS');
        equals(ns.types.length, 0);
        equals(ns.metrics.length, 0);
        equals(ns.parent, mod);
        same(ns.location, ['nsname']);
        equals(ns.fullName, 'nsname');
      });

      test('test add types', function () {
        var ns = Croaker.namespace('aname');
        var type = Croaker.type('t1');
        ns.add([type]);
        deepEqual(ns.types, [type]);
        ns.add([type, type]);
        deepEqual(ns.types, [type, type, type]);
        equals(ns.metrics.length, 0);
      });

      test('fully initialized', function () {
        var mod = Croaker.module('mod.dll', 'version');
        var ns = Croaker.namespace(mod, 'nsname');
        mod.add([ns]);
        mod.init();
        equals(ns.fullName, 'nsname');
        same(ns.location, ['mod.dll', 'nsname']);
      });

      module('type class tests');
      test('test defaults', function () {
        var mod = Croaker.module('mod.dll', 'version');
        var ns = Croaker.namespace(mod, 'nsname');
        var type = Croaker.type(ns, 'tname');
        equals(type.name, 'tname');
        equals(type.tag, 'TY');
        equals(type.members.length, 0);
        equals(type.metrics.length, 0);
        equals(type.parent, ns);
        equals(type.fullName, 'tname');
        same(type.location, ['tname']);
      });

      test('test add members', function () {
        var type = Croaker.type('tname');
        var member = Croaker.member('m1');
        type.add([member]);
        deepEqual(type.members, [member]);
        type.add([member, member]);
        deepEqual(type.members, [member, member, member]);
        equals(type.metrics.length, 0);
      });

      test('fully initialized', function () {
        var mod = Croaker.module('mod.dll', 'version');
        var ns = Croaker.namespace(mod, 'nsname');
        var type = Croaker.type(ns, 'tname');
        mod.add([ns]);
        ns.add([type]);
        mod.init();
        equals(type.fullName, 'nsname.tname');
        same(type.location, ['mod.dll', 'nsname', 'tname']);
      });

      module('member class tests');
      test('test defaults', function () {
        var mod = Croaker.module('mod.dll', 'version');
        var ns = Croaker.namespace(mod, 'nsname');
        var type = Croaker.type(ns, 'tname');
        var member = Croaker.member(type, 'mname');
        equals(member.name, 'mname');
        equals(member.tag, 'M');
        equals(member.metrics.length, 0);
        equals(member.parent, type);
        equals(member.fullName, 'mname');
        same(member.location, ['mname']);
      });

      test('test add metrics', function () {
        var member = Croaker.member('mname');
        var metric = Croaker.metric('m1', 33, member);
        member.addMetrics([metric]);
        equals(member.metrics.length, 1);
        equals(member.metrics[0], metric);
        member.addMetrics([metric, metric]);
        equals(member.metrics.length, 3);
        equals(member.metrics[0], metric);
        equals(member.metrics[1], metric);
        equals(member.metrics[2], metric);
      });

      test('fully initialized', function () {
        var mod = Croaker.module('mod.dll', 'version');
        var ns = Croaker.namespace(mod, 'nsname');
        var type = Croaker.type(ns, 'tname');
        var member = Croaker.member(type, 'mname');
        mod.add([ns]);
        ns.add([type]);
        type.add([member]);
        mod.init();
        equals(member.fullName, 'nsname.tname.mname');
        same(member.location, ['mod.dll', 'nsname', 'tname', 'mname']);
      });

      module('metric class tests');
      test('test defaults', function () {
        var metric = Croaker.metric('aname', 33);
        equals(metric.name, 'aname');
        equals(metric.value, 33);
        equals(metric.parent, null);
        equals(metric.fullName, null);
      });

      module('flattened parse tests');
      test('module parsing', function () {
        var items = parsed.basic.flat;
        equals(items[0].name, 'Some.dll');
        equals(items[0].fullName, 'Some.dll');
        same(items[0].location, ['Some.dll']);
        equals(items[0].version, '1.0.2.3');
        equals(items[0].namespaces.length, 1);
        equals(items[0].parent, null);
      });

      test('module metric parsing', function () {
        var metrics = parsed.basic.flat[0].metrics;
        equals(metrics.length, 5);
        equals(metrics[0].name, 'ClassCoupling');
        equals(metrics[0].value, 11);
        equals(metrics[1].name, 'CyclomaticComplexity');
        equals(metrics[1].value, 2);
        equals(metrics[2].name, 'DepthOfInheritance');
        equals(metrics[2].value, 2);
        equals(metrics[3].name, 'LinesOfCode');
        equals(metrics[3].value, 6);
        equals(metrics[4].name, 'MaintainabilityIndex');
        equals(metrics[4].value, 1);
      });

      test('namespace parsing', function () {
        var items = parsed.basic.flat;
        equals(items[1].name, 'Sample.Core');
        equals(items[1].fullName, 'Sample.Core');
        same(items[1].location, ['Some.dll', 'Sample.Core']);
        equals(items[1].types.length, 1);
        equals(items[1].parent.name, 'Some.dll');
      });

      test('namespace metric parsing', function () {
        var metrics = parsed.basic.flat[1].metrics;
        equals(metrics.length, 5);
        equals(metrics[0].name, 'ClassCoupling');
        equals(metrics[0].value, 11);
        equals(metrics[0].parent.name, 'Sample.Core');
        equals(metrics[1].name, 'CyclomaticComplexity');
        equals(metrics[1].value, 4);
        equals(metrics[1].parent.name, 'Sample.Core');
        equals(metrics[2].name, 'DepthOfInheritance');
        equals(metrics[2].value, 2);
        equals(metrics[2].parent.name, 'Sample.Core');
        equals(metrics[3].name, 'LinesOfCode');
        equals(metrics[3].value, 6);
        equals(metrics[3].parent.name, 'Sample.Core');
        equals(metrics[4].name, 'MaintainabilityIndex');
        equals(metrics[4].value, 3);
        equals(metrics[4].parent.name, 'Sample.Core');
      });

      test('type parsing', function () {
        var type = parsed.basic.flat[2];
        equals(type.name, 'SampleClass');
        equals(type.fullName, 'Sample.Core.SampleClass');
        same(type.location, ['Some.dll', 'Sample.Core', 'SampleClass']);
        equals(type.members.length, 2);
        equals(type.parent.name, 'Sample.Core');
      });

      test('type metric parsing', function () {
        var metrics = parsed.basic.flat[2].metrics;
        equals(metrics.length, 5);
        equals(metrics[0].name, 'ClassCoupling');
        equals(metrics[0].value, 11);
        equals(metrics[0].parent.name, 'SampleClass');
        equals(metrics[1].name, 'CyclomaticComplexity');
        equals(metrics[1].value, 6);
        equals(metrics[1].parent.name, 'SampleClass');
        equals(metrics[2].name, 'DepthOfInheritance');
        equals(metrics[2].value, 2);
        equals(metrics[2].parent.name, 'SampleClass');
        equals(metrics[3].name, 'LinesOfCode');
        equals(metrics[3].value, 6);
        equals(metrics[3].parent.name, 'SampleClass');
        equals(metrics[4].name, 'MaintainabilityIndex');
        equals(metrics[4].value, 5);
        equals(metrics[4].parent.name, 'SampleClass');
      });

      test('member parsing', function () {
        var member = parsed.basic.flat[3];
        equals(member.name, 'Method1(String) : void');
        equals(member.fullName, 'Sample.Core.SampleClass.Method1(String) : void');
        same(member.location, ['Some.dll', 'Sample.Core', 'SampleClass', 'Method1(String) : void']);
        equals(member.parent.name, 'SampleClass');
        member = parsed.basic.flat[4];
        equals(member.name, 'SampleClass()');
        equals(member.fullName, 'Sample.Core.SampleClass.SampleClass()');
        same(member.location, ['Some.dll', 'Sample.Core', 'SampleClass', 'SampleClass()']);
        equals(member.parent.name, 'SampleClass');
      });

      test('full member metric parsing', function () {
        var metrics = parsed.basic.flat[3].metrics;
        equals(metrics.length, 5);
        equals(metrics[0].name, 'ClassCoupling');
        equals(metrics[0].value, 11);
        equals(metrics[0].parent.name, 'Method1(String) : void');
        equals(metrics[1].name, 'CyclomaticComplexity');
        equals(metrics[1].value, 8);
        equals(metrics[1].parent.name, 'Method1(String) : void');
        equals(metrics[2].name, 'DepthOfInheritance');
        equals(metrics[2].value, 2);
        equals(metrics[2].parent.name, 'Method1(String) : void');
        equals(metrics[3].name, 'LinesOfCode');
        equals(metrics[3].value, 6);
        equals(metrics[3].parent.name, 'Method1(String) : void');
        equals(metrics[4].name, 'MaintainabilityIndex');
        equals(metrics[4].value, 7);
        equals(metrics[4].parent.name, 'Method1(String) : void');

      });

      test('partial member metric parsing', function () {
        var metrics = parsed.basic.flat[4].metrics;
        equals(metrics.length, 5);
        equals(metrics[0].name, 'ClassCoupling');
        equals(metrics[0].value, 'N/A');
        equals(metrics[0].parent.name, 'SampleClass()');
        equals(metrics[1].name, 'CyclomaticComplexity');
        equals(metrics[1].value, 10);
        equals(metrics[1].parent.name, 'SampleClass()');
        equals(metrics[2].name, 'DepthOfInheritance');
        equals(metrics[2].value, 'N/A');
        equals(metrics[2].parent.name, 'SampleClass()');
        equals(metrics[3].name, 'LinesOfCode');
        equals(metrics[3].value, 'N/A');
        equals(metrics[3].parent.name, 'SampleClass()');
        equals(metrics[4].name, 'MaintainabilityIndex');
        equals(metrics[4].value, 9);
        equals(metrics[4].parent.name, 'SampleClass()');
      });

      module('hierarchy parse tests');
      test('module parsing', function () {
        var mod = parsed.basic.hierarchy;
        equals(mod.name, 'Some.dll');
        equals(mod.fullName, 'Some.dll');
        same(mod.location, ['Some.dll']);
        equals(mod.version, '1.0.2.3');
        equals(mod.namespaces.length, 1);
        equals(mod.parent, null);
      });

      test('module metric parsing', function () {
        var metrics = parsed.basic.hierarchy.metrics;
        equals(metrics.length, 5);
        equals(metrics[0].name, 'ClassCoupling');
        equals(metrics[0].value, 11);
        equals(metrics[1].name, 'CyclomaticComplexity');
        equals(metrics[1].value, 2);
        equals(metrics[2].name, 'DepthOfInheritance');
        equals(metrics[2].value, 2);
        equals(metrics[3].name, 'LinesOfCode');
        equals(metrics[3].value, 6);
        equals(metrics[4].name, 'MaintainabilityIndex');
        equals(metrics[4].value, 1);
      });

      test('namespace parsing', function () {
        var ns = parsed.basic.hierarchy.namespaces[0];
        equals(ns.name, 'Sample.Core');
        equals(ns.fullName, 'Sample.Core');
        same(ns.location, ['Some.dll', 'Sample.Core']);
        equals(ns.types.length, 1);
        equals(ns.parent.name, 'Some.dll');
      });

      test('namespace metric parsing', function () {
        var metrics = parsed.basic.hierarchy.namespaces[0].metrics;
        equals(metrics.length, 5);
        equals(metrics[0].name, 'ClassCoupling');
        equals(metrics[0].value, 11);
        equals(metrics[0].parent.name, 'Sample.Core');
        equals(metrics[1].name, 'CyclomaticComplexity');
        equals(metrics[1].value, 4);
        equals(metrics[1].parent.name, 'Sample.Core');
        equals(metrics[2].name, 'DepthOfInheritance');
        equals(metrics[2].value, 2);
        equals(metrics[2].parent.name, 'Sample.Core');
        equals(metrics[3].name, 'LinesOfCode');
        equals(metrics[3].value, 6);
        equals(metrics[3].parent.name, 'Sample.Core');
        equals(metrics[4].name, 'MaintainabilityIndex');
        equals(metrics[4].value, 3);
        equals(metrics[4].parent.name, 'Sample.Core');
      });

      test('type parsing', function () {
        var type = parsed.basic.hierarchy.namespaces[0].types[0];
        equals(type.name, 'SampleClass');
        equals(type.fullName, 'Sample.Core.SampleClass');
        same(type.location, ['Some.dll', 'Sample.Core', 'SampleClass']);
        equals(type.members.length, 2);
        equals(type.parent.name, 'Sample.Core');
      });

      test('type metric parsing', function () {
        var metrics = parsed.basic.hierarchy.namespaces[0].types[0].metrics;
        equals(metrics.length, 5);
        equals(metrics[0].name, 'ClassCoupling');
        equals(metrics[0].value, 11);
        equals(metrics[0].parent.name, 'SampleClass');
        equals(metrics[1].name, 'CyclomaticComplexity');
        equals(metrics[1].value, 6);
        equals(metrics[1].parent.name, 'SampleClass');
        equals(metrics[2].name, 'DepthOfInheritance');
        equals(metrics[2].value, 2);
        equals(metrics[2].parent.name, 'SampleClass');
        equals(metrics[3].name, 'LinesOfCode');
        equals(metrics[3].value, 6);
        equals(metrics[3].parent.name, 'SampleClass');
        equals(metrics[4].name, 'MaintainabilityIndex');
        equals(metrics[4].value, 5);
        equals(metrics[4].parent.name, 'SampleClass');
      });

      test('member parsing', function () {
        var members = parsed.basic.hierarchy.namespaces[0].types[0].members;
        equals(members[0].name, 'Method1(String) : void');
        equals(members[0].fullName, 'Sample.Core.SampleClass.Method1(String) : void');
        same(members[0].location, ['Some.dll', 'Sample.Core', 'SampleClass', 'Method1(String) : void']);
        equals(members[0].parent.name, 'SampleClass');
        equals(members[1].name, 'SampleClass()');
        equals(members[1].fullName, 'Sample.Core.SampleClass.SampleClass()');
        same(members[1].location, ['Some.dll', 'Sample.Core', 'SampleClass', 'SampleClass()']);
        equals(members[1].parent.name, 'SampleClass');
      });

      test('full member metric parsing', function () {
        var members = parsed.basic.hierarchy.namespaces[0].types[0].members;
        equals(members[0].metrics.length, 5);
        equals(members[0].metrics[0].name, 'ClassCoupling');
        equals(members[0].metrics[0].value, 11);
        equals(members[0].metrics[0].parent.name, 'Method1(String) : void');
        equals(members[0].metrics[1].name, 'CyclomaticComplexity');
        equals(members[0].metrics[1].value, 8);
        equals(members[0].metrics[1].parent.name, 'Method1(String) : void');
        equals(members[0].metrics[2].name, 'DepthOfInheritance');
        equals(members[0].metrics[2].value, 2);
        equals(members[0].metrics[2].parent.name, 'Method1(String) : void');
        equals(members[0].metrics[3].name, 'LinesOfCode');
        equals(members[0].metrics[3].value, 6);
        equals(members[0].metrics[3].parent.name, 'Method1(String) : void');
        equals(members[0].metrics[4].name, 'MaintainabilityIndex');
        equals(members[0].metrics[4].value, 7);
        equals(members[0].metrics[4].parent.name, 'Method1(String) : void');

      });

      test('partial member metric parsing', function () {
        var members = parsed.basic.hierarchy.namespaces[0].types[0].members;
        equals(members[1].metrics.length, 5);
        equals(members[1].metrics[0].name, 'ClassCoupling');
        equals(members[1].metrics[0].value, 'N/A');
        equals(members[1].metrics[0].parent.name, 'SampleClass()');
        equals(members[1].metrics[1].name, 'CyclomaticComplexity');
        equals(members[1].metrics[1].value, 10);
        equals(members[1].metrics[1].parent.name, 'SampleClass()');
        equals(members[1].metrics[2].name, 'DepthOfInheritance');
        equals(members[1].metrics[2].value, 'N/A');
        equals(members[1].metrics[2].parent.name, 'SampleClass()');
        equals(members[1].metrics[3].name, 'LinesOfCode');
        equals(members[1].metrics[3].value, 'N/A');
        equals(members[1].metrics[3].parent.name, 'SampleClass()');
        equals(members[1].metrics[4].name, 'MaintainabilityIndex');
        equals(members[1].metrics[4].value, 9);
        equals(members[1].metrics[4].parent.name, 'SampleClass()');
      });

      test('parsing type with no members', function () {
        equals(parsed.missing.hierarchy.namespaces[0].types[0].members.length, 0);
      });

      module('metric definition tests');
      test('genera', function () {
        equals(Croaker.metricDefs.length, 5);
      });

      test('class coupling definition', function () {
        equals(Croaker.metricDefs[0].name, 'ClassCoupling');
        equals(Croaker.metricDefs[0].friendlyName, 'Class Coupling');
        equals(Croaker.metricDefs[0].shortName, 'CC');
      });

      test('depth of inheritance definition', function () {
        equals(Croaker.metricDefs[1].name, 'DepthOfInheritance');
        equals(Croaker.metricDefs[1].friendlyName, 'Depth of Inheritance');
        equals(Croaker.metricDefs[1].shortName, 'DoI');
      });

      test('cyclomatic complexity definition', function () {
        equals(Croaker.metricDefs[2].name, 'CyclomaticComplexity');
        equals(Croaker.metricDefs[2].friendlyName, 'Cyclomatic Complexity');
        equals(Croaker.metricDefs[2].shortName, 'CYC');
      });

      test('lines of code definition', function () {
        equals(Croaker.metricDefs[3].name, 'LinesOfCode');
        equals(Croaker.metricDefs[3].friendlyName, 'Lines of Code');
        equals(Croaker.metricDefs[3].shortName, 'LoC');
      });

      test('maintainability index definition', function () {
        equals(Croaker.metricDefs[4].name, 'MaintainabilityIndex');
        equals(Croaker.metricDefs[4].friendlyName, 'Maintainability Index');
        equals(Croaker.metricDefs[4].shortName, 'MI');
      });
    });
  </script>
</head>
<body>
  <h1 id="qunit-header">
    Croaker Unit Tests</h1>
  <h2 id="qunit-banner">
  </h2>
  <div id="qunit-testrunner-toolbar">
  </div>
  <h2 id="qunit-userAgent">
  </h2>
  <ol id="qunit-tests">
  </ol>
  <div id="qunit-fixture">
    test markup, will be hidden
  </div>
</body>
</html>
